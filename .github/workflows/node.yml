name: Node.js CI

on:
  push:
    branches: main
  pull_request:

jobs:
  install:
    name: Checkout and Install
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: PNPM Install With Cache
        uses: ./.github/actions/pnpm-install-with-cache

  lint_website:
    name: Run linter in website
    needs: install
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: PNPM Install With Cache
        uses: ./.github/actions/pnpm-install-with-cache

      - name: Run lint check
        run: pnpm lint
        working-directory: website

  format_website:
    name: Run formatter in website
    needs: install
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: PNPM Install With Cache
        uses: ./.github/actions/pnpm-install-with-cache

      - name: Run format check
        run: pnpm format.check
        working-directory: website

  lint_library:
    name: Run linter in library
    needs: install
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: PNPM Install With Cache
        uses: ./.github/actions/pnpm-install-with-cache

      - name: Run lint check
        run: pnpm lint
        working-directory: library

  format_library:
    name: Run formatter in library
    needs: install
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: PNPM Install With Cache
        uses: ./.github/actions/pnpm-install-with-cache

      - name: Run format check
        run: pnpm format.check
        working-directory: library

  test_library:
    name: Run Vitest in library
    needs: install
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: PNPM Install With Cache
        uses: ./.github/actions/pnpm-install-with-cache

      - name: Run Vitest
        run: pnpm test
        working-directory: library
